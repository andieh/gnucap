load public models-uf.so
spice
.load c_wave.so
* p type inv amp w/bti
.options TEMP=25

.load rcd_sym.so
*.options numdgt=7

.param pulse_iv=0
.param pulse_rise=1n

.param voff=0.4
.model my_rcdmodel rcd_exp

.model singleton bti_sum (
+ parms = (
+  (65734.764403498935, -1, 7.6851098109742111, 33.944029750879885, 20.802215970322095)
+ )
+ rcd_model_name=my_rcdmodel
+ weight=1
+)

.model cmosp pmos(
+level=8
+bti_model=singleton
+)

.param vdd=3
V1 nin ndd sin ( delay=-0.025m amplitude={vdd/3} frequency=1e4 offset={-vdd/2})
R2 nin ng 10k
MP1 nout ng ndd ndd cmosp l=4.e-5 w=4.5e-6

* wont work. argh
* MPreversed ndd ng nout ndd cmosp l=1.5e-5 w=4.5e-6

R1 0 nout 9k
VDD ndd 0 vdd

.verilog
measm mym(nout,0);
spice

.print tran dvth(MP1) dvth(MP1.BTI) tau(MP1.BTI.*) stress(MP1.BTI)
+ max(mym)
+ dvth(MP1.bti)
+ iscale(MP1.bti)

.store tran dvth(MP1.BTI)
.tran 0 .1m 1u noage basic > foo.out
.measure bti_noage=at(probe="dvth(MP1.BTI)" x=.1m)

.tran 0 .1m 1u noage basic > foo.out
.measure bti_noage=at(probe="dvth(MP1.BTI)" x=.1m)

.tran 0 .1m 1u age basic > foo.out
.echo age
.measure bti_age=at(probe="dvth(MP1.BTI)" x=.1m)

* hack. fix later
.ttr 0 0 0 new > /dev/null
.echo >>foo.out

.tran 0 .1m .1m trace=a age basic >> foo.out
.measure bti2=at(probe="dvth(MP1.BTI)" x=.1m)

* hack. fix later
.ttr 0 0 0 new > /dev/null
.echo tran storelist
.store tran
.echo wavelist
.wave list
.wave list tran
.wave dump "dvth(MP1.BTI)"
.print tran
.tran 0 .1m .1m trace=a age basic
.echo posttran
.wave list
.wave list tran
.wave dump "dvth(MP1.BTI)"

.measure bti3=at(probe="dvth(MP1.BTI)" x=.1m)

* hack. fix later
.ttr 0 0 0 new > /dev/null

.tran 0 .1m .1m trace=a noage basic
.measure bti3=at(probe="dvth(MP1.BTI)" x=.1m)
.echo tran storelist (this is a bug)
.store tran

.status notime

.end
